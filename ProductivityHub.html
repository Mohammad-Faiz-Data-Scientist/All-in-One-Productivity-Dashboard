<!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Productivity Hub</title>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
      <style>
          @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

          :root {
              --bg: #F8F9FA;
              --card: #FFFFFF;
              --text: #212529;
              --muted: #6C757D;
              --brand: #007BFF;
              --accent: #DC3545;
              --ok: #28A745;
              --warn: #FFC107;
              --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
              --lo: #28A745;
              --md: #FFC107;
              --hi: #DC3545;
              --chip: #E9ECEF;
              --border: #DEE2E6;
              --icon: #6C757D;

              /* Variables for card highlight */
              --pulse-color-card-start: rgba(52, 152, 219, 0.5);
              --pulse-color-card-end: rgba(52, 152, 219, 0.9);

              /* NEW/REFINED variables for specific item highlight (task/event) */
              --pulse-color-item-initial: rgba(0, 123, 255, 0.3); /* Very light initial border/shadow */
              --pulse-color-item-glow: rgba(0, 123, 255, 1);    /* Full color for the glow peak */
              --pulse-background-item: rgba(0, 123, 255, 0.1);  /* Subtle background flash */
          }

          [data-theme="dark"] {
              --bg: #1A212A;
              --card: #283747;
              --text: #F8F9F9;
              --muted: #BDC3C7;
              --brand: #6EA8FE;
              --accent: #E74C3C;
              --ok: #2ECC71;
              --warn: #F1C40F;
              --shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
              --chip: #34495E;
              --border: #3A536B;
              --lo: #27AE60;
              --md: #F39C12;
              --hi: #E74C3C;
              --icon: #BDC3C7;

              /* Variables for dark theme card highlight */
              --pulse-color-card-start: rgba(110, 168, 254, 0.5);
              --pulse-color-card-end: rgba(110, 168, 254, 0.9);

              /* NEW/REFINED variables for dark theme specific item highlight */
              --pulse-color-item-initial: rgba(110, 168, 254, 0.3);
              --pulse-color-item-glow: rgba(110, 168, 254, 1);
              --pulse-background-item: rgba(110, 168, 254, 0.2);
          }

          * {
              box-sizing: border-box;
              font-family: 'Roboto', sans-serif;
              transition: background-color 0.3s, color 0.3s, box-shadow 0.3s, border-color 0.3s, transform 0.3s;
          }

          body {
              margin: 0;
              background: var(--bg);
              color: var(--text);
              padding: 0;
              line-height: 1.6;
          }
          
          .tracker-wrapper {
              padding: 20px;
              display: flex;
              flex-direction: column;
              min-height: 100vh;
          }
          
          @media (max-width: 768px) {
              .tracker-wrapper {
                  padding: 10px;
              }
          }

          h1 {
              margin: 0 0 25px;
              text-align: center;
              color: var(--brand);
              font-size: clamp(24px, 5vw, 32px);
              font-weight: 700;
          }
          
          .toolbar {
              display: flex;
              gap: 12px;
              justify-content: center;
              margin-bottom: 20px;
              flex-wrap: wrap;
          }
          
          .toolbar button, .toolbar label, .btn {
              border: none;
              border-radius: 8px;
              padding: 10px 16px;
              cursor: pointer;
              background: var(--brand);
              color: #fff;
              font-weight: 500;
              font-size: 14px;
              display: inline-flex;
              align-items: center;
              gap: 8px;
              white-space: nowrap;
          }
          
          .toolbar .reset { background: var(--accent); }
          .btn.ok { background: var(--ok); }
          .btn.delete-btn { background: var(--accent); }
          .btn.warn { background: var(--warn); }
          .btn.mode-btn { background: var(--brand); }

          #importInput { display: none; }
          
          .content-grid {
              display: grid;
              grid-template-columns: 1fr;
              gap: 20px;
              flex-grow: 1;
          }
          
          @media (min-width: 992px) {
              .content-grid {
                  grid-template-columns: 1fr 1fr;
              }
          }
          
          .column {
              display: flex;
              flex-direction: column;
              gap: 20px;
              min-width: 0;
          }
          
          .card {
              background: var(--card);
              border-radius: 16px;
              box-shadow: var(--shadow);
              padding: 20px;
              border: 1px solid var(--border);
              display: flex;
              flex-direction: column;
              flex-grow: 1;
          }
          
          .card.highlight {
              box-shadow: 0 0 10px 3px var(--pulse-color-card-start);
              animation: pulse-card-glow 1.5s ease-in-out infinite alternate;
              transform-origin: center;
          }

          /* --- Specific Item (Task/Event) Highlighting --- */
          .highlight-item {
              /* Animation is applied to border and box-shadow */
              animation: pulse-item-glow 1.8s ease-in-out infinite alternate !important;
          }
          
          @keyframes pulse-card-glow {
              from {
                  box-shadow: 0 0 10px 3px var(--pulse-color-card-start);
                  transform: scale(1);
              }
              to {
                  box-shadow: 0 0 20px 8px var(--pulse-color-card-end);
                  transform: scale(1.01);
              }
          }

          @keyframes pulse-item-glow {
              from {
                  border-color: var(--pulse-color-item-initial) !important;
                  box-shadow: 0 0 2px 0px var(--pulse-color-item-initial) !important;
                  background-color: var(--chip);
                  transform: scale(1);
              }
              to {
                  border-color: var(--pulse-color-item-glow) !important;
                  box-shadow: 0 0 10px 0px var(--pulse-color-item-glow) !important;
                  background-color: var(--pulse-background-item);
                  transform: scale(1);
              }
          }
          /* ----------------------------------------------- */
          
          .card h2 {
              margin: 0 0 15px;
              font-size: 20px;
              font-weight: 600;
              color: var(--text);
          }
          
          .timer-card {
              align-items: center;
          }
          
          .dial {
              position: relative;
              width: clamp(180px, 80%, 250px);
              aspect-ratio: 1 / 1;
              display: grid;
              place-items: center;
              margin-bottom: 20px;
          }
          
          .dial svg {
              position: absolute;
              inset: 0;
              width: 100%;
              height: 100%;
              transform: rotate(-90deg);
          }
          
          .dial-time {
              font-size: clamp(40px, 12vw, 60px);
              font-weight: 700;
              color: var(--text);
          }
          
          .dial-sub {
              font-size: 14px;
              color: var(--muted);
              margin-top: 4px;
          }
          
          .chip {
              display: inline-flex;
              align-items: center;
              gap: 6px;
              background: var(--chip);
              color: var(--muted);
              padding: 6px 10px;
              border-radius: 999px;
              font-size: 12px;
          }
          
          .controls {
              display: flex;
              flex-wrap: wrap;
              gap: 10px;
              justify-content: center;
              width: 100%;
          }
          
          .btn { min-width: 80px; }
          .btn.start { background: var(--ok); }
          .btn.pause { background: var(--warn); }
          .btn.reset { background: var(--accent); }
          
          input, select {
              padding: 10px;
              border-radius: 8px;
              border: 1px solid var(--border);
              background: var(--chip);
              color: var(--text);
              font-size: 14px;
              width: 100%;
          }

          select {
              -webkit-appearance: none;
              -moz-appearance: none;
              appearance: none;
              background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="rgb(127,140,141)" d="M7 10l5 5 5-5z"/></svg>');
              background-repeat: no-repeat;
              background-position: right 10px center;
              background-size: 16px;
              padding-right: 30px;
              cursor: pointer;
          }
          
          select {
              color: var(--text) !important;
          }
          
          .task-input {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
              gap: 10px;
              margin-bottom: 15px;
          }

          .task-input-row-2 {
              display: flex;
              gap: 10px;
              align-items: center;
              flex-wrap: wrap;
              margin-bottom: 15px;
          }

          .task-input-row-2 > * {
              flex: 1 1 auto;
              min-width: 150px;
          }
          
          .select-wrapper, .input-with-icon {
              position: relative;
          }
          
          .input-with-icon .material-symbols-outlined {
              position: absolute;
              right: 10px;
              top: 50%;
              transform: translateY(-50%);
              pointer-events: none;
              color: var(--icon);
          }

          .input-with-icon input {
              padding-right: 35px;
          }
          
          .todo-list-container {
              flex-grow: 1;
              max-height: 400px;
              overflow-y: auto;
              display: flex;
              flex-direction: column;
              gap: 10px;
              padding-right: 5px;
          }

          ul {
              list-style: none;
              margin: 0;
              padding: 0;
              display: flex;
              flex-direction: column;
              gap: 10px;
          }
          
          li.task {
              display: flex; 
              gap: 10px;
              align-items: center;
              background: var(--chip);
              padding: 12px;
              border-radius: 10px; /* IMPORTANT: Ensures box-shadow and border follow this */
              border: 1px solid var(--border);
              overflow: hidden;
              transition: box-shadow 0.3s ease-in-out, background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
          }
          
          li.task .task-actions {
              display: flex;
              gap: 8px;
              justify-content: flex-end;
              min-width: 0;
              flex-shrink: 0; 
          }
          
          .task-details {
              flex: 1; 
              display: flex;
              flex-direction: column;
              overflow: hidden;
              min-width: 0; 
          }
          
          .task-details > div:first-child {
              font-weight: 600;
              text-overflow: ellipsis;
              overflow: hidden;
              white-space: nowrap;
          }
          
          .task-details .meta {
              display: flex;
              gap: 8px;
              font-size: 12px;
              color: var(--muted);
              margin-top: 4px;
              flex-wrap: wrap; 
          }
          
          .badge {
              padding: 4px 8px;
              border-radius: 999px;
              font-size: 11px;
              color: #fff;
              text-align: center;
              font-weight: 600;
              white-space: nowrap;
          }
          
          .b-hi { background-color: var(--hi); color: #fff; }
          .b-md { background-color: var(--md); color: var(--text); }
          .b-lo { background-color: var(--lo); color: #fff; }

          .task.completed {
              opacity: 0.6;
          }
          
          .task.completed .task-details > div:first-child {
              text-decoration: line-through;
          }
          
          /* RESTORED original event-card styles */
          .event-card {
              padding: 15px;
              border-left: 5px solid var(--brand);
              background: var(--chip);
              border-radius: 10px;
              margin-bottom: 10px;
              border: 1px solid var(--border);
              display: flex;
              align-items: center;
              justify-content: space-between;
              transition: box-shadow 0.3s ease-in-out, background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
          }
          
          .event-details {
              flex: 1;
          }
          
          .event-input {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
              gap: 10px;
              margin-bottom: 15px;
          }

          .event-list-container {
              max-height: 400px;
              overflow-y: auto;
              display: flex;
              flex-direction: column;
              gap: 10px;
          }
          
          .dashboard-pro {
              gap: 15px;
          }

          .dashboard-pro-grid {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
              gap: 15px;
              height: 100%;
          }
          
          @media (min-width: 1200px) {
              .dashboard-pro-grid {
                  grid-template-columns: repeat(4, 1fr);
              }
          }

          .kpi-card {
              background: var(--chip);
              border-radius: 12px;
              padding: 20px;
              display: flex;
              flex-direction: column;
              justify-content: space-between;
              border: 1px solid var(--border);
              transition: transform 0.2s ease, box-shadow 0.2s ease;
          }
          .kpi-card:hover {
              transform: translateY(-5px);
              box-shadow: var(--shadow);
          }

          .kpi-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
          }
          
          .kpi-label {
              font-size: 14px;
              font-weight: 500;
              color: var(--muted);
          }

          .kpi-icon {
              width: 40px;
              height: 40px;
              border-radius: 8px;
              display: grid;
              place-items: center;
              color: #fff;
              transition: background 0.3s;
          }
          
          .kpi-icon .material-symbols-outlined {
              color: #fff;
              font-size: 24px;
          }

          .kpi-value {
              font-size: clamp(24px, 4vw, 32px);
              font-weight: 700;
              color: var(--text);
              margin-top: 10px;
              line-height: 1.1;
          }

          .kpi-card.focus-kpi .kpi-icon {
              background: linear-gradient(135deg, #6EA8FE, #3498DB);
          }
          
          .kpi-card.tasks-kpi .kpi-icon {
              background: linear-gradient(135deg, #58D68D, #27AE60);
          }

          .kpi-card.events-kpi .kpi-icon {
              background: linear-gradient(135deg, #FFC107, #F39C12);
          }
          
          .chart-wrapper {
              grid-column: 1 / -1;
              background: var(--chip);
              border-radius: 12px;
              padding: 20px;
              border: 1px solid var(--border);
              display: flex;
              flex-direction: column;
          }

          .chart-wrapper h3 {
              margin: 0 0 15px;
              font-size: 16px;
              font-weight: 600;
              color: var(--text);
          }
          
          canvas#weekChart {
              flex-grow: 1;
              min-height: 150px;
          }

          #sessionHistory {
              max-height: 400px;
              overflow-y: auto;
              display: flex;
              flex-direction: column;
              gap: 10px;
              padding-right: 10px;
          }

          #sessionHistory::-webkit-scrollbar {
              width: 8px;
          }
          #sessionHistory::-webkit-scrollbar-track {
              background: var(--chip);
              border-radius: 4px;
          }
          #sessionHistory::-webkit-scrollbar-thumb {
              background: var(--border);
              border-radius: 4px;
          }
          #sessionHistory::-webkit-scrollbar-thumb:hover {
              background: var(--muted);
          }

          .history-entry {
              display: flex;
              align-items: center;
              gap: 15px;
              padding: 12px;
              background: var(--chip);
              border-radius: 10px;
              border: 1px solid var(--border);
          }

          .history-icon-wrapper {
              flex-shrink: 0;
              width: 40px;
              height: 40px;
              border-radius: 50%;
              display: grid;
              place-items: center;
              background: var(--border);
          }
          
          .history-icon-wrapper .material-symbols-outlined {
              color: var(--icon);
              font-size: 22px;
          }
          
          .history-details {
              flex-grow: 1;
              min-width: 0;
          }

          .history-purpose {
              font-size: 16px;
              font-weight: 600;
              color: var(--text);
              white-space: nowrap;
              overflow: hidden;
              text-overflow: ellipsis;
              cursor: pointer;
          }

          .history-purpose input {
              font-size: 16px;
              font-weight: 600;
              padding: 2px 5px;
              background: var(--card);
          }

          .history-timestamp {
              font-size: 12px;
              color: var(--muted);
          }
          
          .history-duration {
              flex-shrink: 0;
              font-size: 14px;
              font-weight: 500;
              padding: 4px 10px;
              background: var(--border);
              color: var(--text);
              border-radius: 999px;
              white-space: nowrap;
          }
          
          .history-empty-state {
              text-align: center;
              padding: 40px 20px;
              color: var(--muted);
          }
          
          .bottom-grid {
              margin-top: 20px;
              display: grid;
              grid-template-columns: 1fr;
              gap: 20px;
          }
          
          @media (min-width: 992px) {
              .bottom-grid {
                  grid-template-columns: 1fr 1fr;
              }
          }
          
          .bottom-grid .card {
              flex-grow: 1;
          }

          .material-symbols-outlined {
              font-family: 'Material Symbols Outlined';
              font-weight: normal;
              font-style: normal;
              font-size: 20px;
              display: inline-block;
              line-height: 1;
              text-transform: none;
              letter-spacing: normal;
              word-wrap: normal;
              white-space: nowrap;
              direction: ltr;
              -webkit-font-smoothing: antialiased;
              text-rendering: optimizeLegibility;
              -moz-osx-font-smoothing: grayscale;
              font-feature-settings: 'liga';
              color: var(--icon);
          }

          .btn .material-symbols-outlined { color: #fff; }
          .ok .material-symbols-outlined { color: #fff; }
          .delete-btn .material-symbols-outlined { color: #fff; }

          .flatpickr-calendar {
              background: var(--card);
              border-radius: 8px;
              border: 1px solid var(--border);
              box-shadow: var(--shadow);
              color: var(--text);
          }
          .flatpickr-months .flatpickr-month, .flatpickr-weekdays, .flatpickr-time {
              background: var(--bg);
              color: var(--text);
          }
          .flatpickr-day, .flatpickr-weekday {
              color: var(--text);
          }
          .flatpickr-day.today {
              border-color: var(--brand);
          }
          .flatpickr-day.selected, .flatpickr-day.startRange, .flatpickr-day.endRange {
              background: var(--brand);
              color: #fff;
              border-color: var(--brand);
          }
          .flatpickr-months .flatpickr-prev-month, .flatpickr-months .flatpickr-next-month {
              fill: var(--text);
          }
          .numInput, .numInputWrapper {
              color: var(--text);
          }
          .flatpickr-time .flatpickr-am-pm, .flatpickr-time input {
              background: var(--chip);
              color: var(--text);
          }
          .flatpickr-time .flatpickr-am-pm:hover, .flatpickr-time input:hover,
          .flatpickr-time .flatpickr-am-pm:focus, .flatpickr-time input:focus {
              background: var(--border);
          }
          
      </style>
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  </head>
<body>
    
    <div class="tracker-wrapper">
        <h1>Productivity Hub</h1>
        <div class="toolbar">
            <button id="themeToggle"><span class="material-symbols-outlined">dark_mode</span> Theme</button>
            <button id="exportBtn"><span class="material-symbols-outlined">download</span> Export Data</button>
            <label style="cursor:pointer;"><span class="material-symbols-outlined">upload</span> Import JSON <input id="importInput" type="file" accept="application/json"></label>
            <button class="reset" id="fullResetBtn"><span class="material-symbols-outlined">delete_forever</span> Full Reset</button>
        </div>
        
        <div class="content-grid">
            <div class="column">
                <div class="card timer-card">
                    <h2>Timer</h2>
                    <div id="timer">
                        <div class="dial">
                            <svg viewBox="0 0 120 120" aria-hidden="true">
                                <circle cx="60" cy="60" r="54" stroke="var(--border)" stroke-width="12" fill="none" />
                                <circle id="progressRing" cx="60" cy="60" r="54" stroke="var(--accent)" stroke-width="12" fill="none" stroke-linecap="round" stroke-dasharray="339.292" stroke-dashoffset="339.292" />
                            </svg>
                            <div style="display:flex;flex-direction:column;align-items:center;z-index:1">
                                <div class="dial-time" id="timeDisplay">00:00</div>
                                <div class="chip" id="modeChip">Mode: Stopwatch</div>
                                <div class="dial-sub" id="kolkataTime"></div>
                            </div>
                        </div>
                        <div class="controls">
                            <button class="btn start" id="startBtn"><span class="material-symbols-outlined">play_arrow</span> Start</button>
                            <button class="btn pause" id="pauseBtn"><span class="material-symbols-outlined">pause</span> Pause</button>
                            <button class="btn reset" id="resetBtn"><span class="material-symbols-outlined">restart_alt</span> Reset</button>
                        </div>
                        <div style="width:100%; display:flex; gap:10px; margin-top: 15px;">
                            <select id="modeSelectDropdown" style="flex:1;">
                                <option value="work">Work</option>
                                <option value="short">Short Break</option>
                                <option value="long">Long Break</option>
                                <option value="stopwatch">Stopwatch</option>
                                <option value="custom">Custom</option>
                            </select>
                            <input type="number" id="customMinutesInput" value="25" min="1" placeholder="Mins" style="display: none; flex: 1;">
                            <label class="chip" style="cursor:pointer;"><input id="focusToggle" type="checkbox" checked> Focus</label>
                            <button class="btn delete-btn" id="stopSoundBtn" style="display:none;"><span class="material-symbols-outlined">volume_off</span></button>
                        </div>
                        <div style="width:100%; margin-top:15px;">
                            <input type="text" id="sessionPurpose" placeholder="What are you working on?" autocomplete="off"/>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="column">
                <div class="card todo-card">
                    <h2>To-Do List</h2>
                    <div class="task-input">
                        <input type="text" id="taskTitle" placeholder="Task title" autocomplete="off"/>
                        <div class="select-wrapper">
                            <select id="taskPriorityDropdown" autocomplete="off">
                                <option value="High">High</option>
                                <option value="Medium" selected>Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                        <input type="text" id="taskSubject" placeholder="Subject / Category" autocomplete="off"/>
                        <div class="input-with-icon">
                            <input type="text" id="taskDue" placeholder="Select date" autocomplete="off"/>
                            <span class="material-symbols-outlined">calendar_month</span>
                        </div>
                        <div class="input-with-icon">
                            <input type="text" id="taskTime" placeholder="Select time" autocomplete="off"/>
                            <span class="material-symbols-outlined">schedule</span>
                        </div>
                        <button class="btn mode-btn" id="addTaskBtn"><span class="material-symbols-outlined">add</span> Add</button>
                    </div>
                    <div class="task-input-row-2">
                        <div class="select-wrapper">
                            <select id="taskSortDropdown" autocomplete="off">
                                <option value="priority">Sort by Priority</option>
                                <option value="due">Sort by Due Date</option>
                                <option value="created">Sort by Created</option>
                            </select>
                        </div>
                        <input type="text" id="taskSearch" placeholder="Search tasks…" autocomplete="off"/>
                    </div>
                    <div id="taskListContainer" class="todo-list-container">
                        <ul id="taskList"></ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bottom-grid">
            <div class="card event-card-container">
                <h2>Countdown Events</h2>
                <div class="event-input">
                    <input type="text" id="eventName" placeholder="Event name" autocomplete="off"/>
                    <div class="input-with-icon">
                        <input type="text" id="eventDate" placeholder="Select date" autocomplete="off"/>
                        <span class="material-symbols-outlined">calendar_month</span>
                    </div>
                    <div class="input-with-icon">
                        <input type="text" id="eventTime" placeholder="Select time" autocomplete="off"/>
                        <span class="material-symbols-outlined">schedule</span>
                    </div>
                    <button class="btn mode-btn" id="addEventBtn"><span class="material-symbols-outlined">add</span> Add</button>
                </div>
                <div id="eventList" class="event-list-container"></div>
            </div>

            <div class="card dashboard-pro">
                <h2>Dashboard</h2>
                <div class="dashboard-pro-grid">
                    <div class="kpi-card focus-kpi">
                        <div class="kpi-header">
                            <div class="kpi-label">Focus Today</div>
                            <div class="kpi-icon">
                                <span class="material-symbols-outlined">timer</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="focusToday">0m</div>
                    </div>
                    <div class="kpi-card tasks-kpi">
                        <div class="kpi-header">
                            <div class="kpi-label">Tasks Done</div>
                            <div class="kpi-icon">
                                <span class="material-symbols-outlined">task_alt</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="tasksToday">0</div>
                    </div>
                    <div class="kpi-card events-kpi">
                        <div class="kpi-header">
                            <div class="kpi-label">Events Done</div>
                            <div class="kpi-icon">
                                <span class="material-symbols-outlined">celebration</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="eventsToday">0</div>
                    </div>
                    <div class="kpi-card productivity-kpi" id="productivityCard">
                        <div class="kpi-header">
                            <div class="kpi-label">Productivity</div>
                            <div class="kpi-icon" id="productivityIconContainer">
                                <span class="material-symbols-outlined" id="productivityIcon">coffee</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="productivityStatus">...</div>
                    </div>
                    <div class="chart-wrapper">
                        <h3>Weekly Focus (minutes)</h3>
                        <canvas id="weekChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card timer-history-card">
                <h2>Timer History</h2>
                <div id="sessionHistory"></div>
            </div>
        </div>
    </div>
    
    <audio id="timerEndSound" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" preload="auto"></audio>
    <audio id="todoAlarmSound" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3" preload="auto"></audio>
    <audio id="eventAlarmSound" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3" preload="auto"></audio>
    
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        const $ = (s) => document.querySelector(s);
        const $$ = (s) => document.querySelectorAll(s);
        const LS = {
            get(k, def) { try { return JSON.parse(localStorage.getItem(k)) ?? def } catch { return def } },
            set(k, v) { localStorage.setItem(k, JSON.stringify(v)) }
        };
        const todayKey = () => new Date().toISOString().slice(0, 10);
        
        const timerEndSound = $("#timerEndSound");
        const todoAlarmSound = $("#todoAlarmSound");
        const eventAlarmSound = $("#eventAlarmSound");
        const stopSoundBtn = $("#stopSoundBtn");
        
        let activeHighlightElements = [];

        function playSound(audioElement, cardSelector, itemSelector) {
            stopSound();
            audioElement.currentTime = 0;
            audioElement.play();
            stopSoundBtn.style.display = 'block';
            
            const card = $(cardSelector);
            if (card) {
                card.classList.add('highlight');
                activeHighlightElements.push(card);
            }

            if (itemSelector) {
                const item = $(itemSelector);
                if (item) {
                    item.classList.add('highlight-item');
                    activeHighlightElements.push(item);
                }
            }
        }

        function stopSound() {
            timerEndSound.pause();
            timerEndSound.currentTime = 0;
            todoAlarmSound.pause();
            todoAlarmSound.currentTime = 0;
            eventAlarmSound.pause();
            eventAlarmSound.currentTime = 0;
            stopSoundBtn.style.display = 'none';

            activeHighlightElements.forEach(el => {
                el.classList.remove('highlight');
                el.classList.remove('highlight-item');
            });
            activeHighlightElements = [];
        }

        stopSoundBtn.onclick = stopSound;
        
        function formatTime(h, m) {
            const period = h >= 12 ? 'PM' : 'AM';
            const hour = h % 12 || 12;
            const minute = m.toString().padStart(2, '0');
            return `${hour}:${minute} ${period}`;
        }
        
        function initDatePickers() {
            flatpickr("#taskDue", { altInput: true, altFormat: "F j, Y", dateFormat: "Y-m-d", defaultDate: "today" });
            flatpickr("#eventDate", { altInput: true, altFormat: "F j, Y", dateFormat: "Y-m-d", defaultDate: "today" });
            flatpickr("#taskTime", { enableTime: true, noCalendar: true, altInput: true, altFormat: "h:i K", dateFormat: "H:i" });
            flatpickr("#eventTime", { enableTime: true, noCalendar: true, altInput: true, altFormat: "h:i K", dateFormat: "H:i" });
        }
        
        (function initTheme() {
            let theme = LS.get("theme", "light");
            document.documentElement.setAttribute('data-theme', theme);
            $("#themeToggle").onclick = () => {
                theme = theme === "dark" ? "light" : "dark";
                document.documentElement.setAttribute('data-theme', theme);
                LS.set("theme", theme);
                renderStats();
            };
        })();
        
        $('#fullResetBtn').onclick = () => {
            localStorage.clear();
            location.reload();
        };

        let tasks = LS.get('tasks', []);
        let tasksCompletedToday = LS.get('tasksCompletedToday', {});
        
        function addTask() {
            const title = $('#taskTitle').value.trim();
            if (!title) return;
            const t = {
                id: Date.now(),
                title,
                priority: $('#taskPriorityDropdown').value,
                subject: $('#taskSubject').value.trim(),
                due: $('#taskDue').value || '',
                dueTime: $('#taskTime')._flatpickr.input.value ? $('#taskTime')._flatpickr.input.value : '',
                completed: false,
                created: Date.now(),
                alarmPlayed: false,
            };
            tasks.unshift(t);
            LS.set('tasks', tasks);
            $('#taskTitle').value = '';
            renderTasks();
            renderProductivityIndex();
        }
        
        function toggleTask(id) {
            const t = tasks.find(x => x.id === id);
            if (!t) return;
            const before = t.completed;
            t.completed = !t.completed;
            LS.set('tasks', tasks);
            if (!before && t.completed) {
                const key = todayKey();
                tasksCompletedToday[key] = (tasksCompletedToday[key] || 0) + 1;
                LS.set('tasksCompletedToday', tasksCompletedToday)
            } else if (before && !t.completed) {
                const key = todayKey();
                tasksCompletedToday[key] = Math.max(0, (tasksCompletedToday[key] || 0) - 1);
                LS.set('tasksCompletedToday', tasksCompletedToday)
            }
            renderTasks();
            renderStatsCounters();
            renderProductivityIndex();
        }
        
        function deleteTask(id) {
            const taskToDelete = tasks.find(t => t.id === id);
            if (taskToDelete && taskToDelete.completed) {
                const key = todayKey();
                tasksCompletedToday[key] = Math.max(0, (tasksCompletedToday[key] || 0) - 1);
                LS.set('tasksCompletedToday', tasksCompletedToday);
            }
            tasks = tasks.filter(t => t.id !== id);
            LS.set('tasks', tasks);
            renderTasks();
            renderStatsCounters();
            renderProductivityIndex();
        }
        
        function priorityBadge(p) {
            return `<span class="badge b-${p.toLowerCase()}">${p}</span>`;
        }

        function checkTaskAlarms() {
            tasks.forEach(t => {
                if (!t.completed && t.due && t.dueTime && !t.alarmPlayed) {
                    const dueDateTime = new Date(`${t.due}T${t.dueTime}:00`);
                    if (dueDateTime <= new Date()) {
                        playSound(todoAlarmSound, '.todo-card', `#task_${t.id}`);
                        t.alarmPlayed = true;
                        LS.set('tasks', tasks);
                        if (Notification.permission === 'granted') {
                            new Notification('To-Do Task Overdue', { body: `Task: ${t.title} is overdue!` });
                        }
                    }
                }
            });
        }
        
        function renderTasks() {
            const q = $('#taskSearch').value.toLowerCase();
            const sort = $('#taskSortDropdown').value;
            let list = [...tasks];
            if (q) list = list.filter(t => t.title.toLowerCase().includes(q) || t.subject.toLowerCase().includes(q));
            
            list.sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                
                if (sort === 'priority') {
                    return ({ High: 0, Medium: 1, Low: 2 }[a.priority] - ({ High: 0, Medium: 1, Low: 2 }[b.priority]));
                }
                if (sort === 'due') {
                    const dateA = a.due ? new Date(a.due + 'T' + (a.dueTime || '00:00')) : new Date('9999-01-01');
                    const dateB = b.due ? new Date(b.due + 'T' + (b.dueTime || '00:00')) : new Date('9999-01-01');
                    return dateA - dateB;
                }
                if (sort === 'created') {
                    return b.created - a.created;
                }
                return 0;
            });

            const ul = $('#taskList');
            ul.innerHTML = '';
            list.forEach(t => {
                const li = document.createElement('li');
                li.className = 'task' + (t.completed ? ' completed' : '');
                li.id = `task_${t.id}`;
                
                let dueInfo = '-';
                let isLate = false;
                if (t.due) {
                    const dueDateTime = new Date(`${t.due}T${t.dueTime || '23:59'}:00`);
                    isLate = dueDateTime < new Date();
                    const date = new Date(t.due).toLocaleDateString();
                    const time = t.dueTime ? formatTime(parseInt(t.dueTime.split(':')[0]), parseInt(t.dueTime.split(':')[1])) : '';
                    dueInfo = `${date} ${time}`;
                }
                
                li.innerHTML = `
                <div class="task-details">
                    <div>${t.title}</div>
                    <div class="meta">
                        ${priorityBadge(t.priority)}
                        <span>${t.subject || ''}</span>
                    </div>
                    <div class="meta" style="margin-top:2px;">
                        ${t.due ? `<span>Due: ${dueInfo}</span>` : '<span>No Due Date</span>'}
                        ${isLate && !t.completed ? '<span class="badge b-hi">Late</span>' : ''}
                    </div>
                </div>
                <div class="task-actions">
                    <button class="btn ok" style="padding:8px; font-size:18px;" onclick="toggleTask(${t.id})"><span class="material-symbols-outlined">done</span></button>
                    <button class="btn delete-btn" style="padding:8px" onclick="deleteTask(${t.id})"><span class="material-symbols-outlined">delete</span></button>
                </div>`;
                ul.appendChild(li);
            });
        }
        
        function renderStatsCounters() {
            const key = todayKey();
            $('#tasksToday').textContent = (tasksCompletedToday[key] || 0);
        }
        
        $('#addTaskBtn').onclick = addTask;
        $('#taskSearch').oninput = renderTasks;
        $('#taskSortDropdown').addEventListener('change', renderTasks);
        
        let events = LS.get('events', []);
        let eventsCompletedToday = LS.get('eventsCompletedToday', {});
        
        function addEvent() {
            const name = $('#eventName').value.trim();
            const date = $('#eventDate').value;
            const time = $('#eventTime')._flatpickr.input.value ? $('#eventTime')._flatpickr.input.value : '';
            if (!name || !date) return;
            events.unshift({ id: Date.now(), name, date, time, completed: false, alarmPlayed: false });
            LS.set('events', events);
            $('#eventName').value = '';
            renderEvents();
        }
        
        function toggleEvent(id) {
            const e = events.find(x => x.id === id);
            if (!e) return;
            const before = e.completed;
            e.completed = !e.completed;
            LS.set('events', events);

            const key = todayKey();
            if (!before && e.completed) {
                eventsCompletedToday[key] = (eventsCompletedToday[key] || 0) + 1;
            } else if (before && !e.completed) {
                eventsCompletedToday[key] = Math.max(0, (eventsCompletedToday[key] || 0) - 1);
            }
            LS.set('eventsCompletedToday', eventsCompletedToday);

            renderEvents();
            renderEventStatsCounter();
        }
        
        function removeEvent(id) {
            const eventToRemove = events.find(e => e.id === id);
            if (eventToRemove && eventToRemove.completed) {
                const key = todayKey();
                eventsCompletedToday[key] = Math.max(0, (eventsCompletedToday[key] || 0) - 1);
                LS.set('eventsCompletedToday', eventsCompletedToday);
            }
            events = events.filter(e => e.id !== id);
            LS.set('events', events);
            renderEvents();
            renderEventStatsCounter();
        }
        
        function eventDiff(date, time) {
            const now = new Date();
            const target = new Date(`${date}T${time || '00:00'}:00`);
            const diff = target - now;
            if (diff <= 0) return null;
            const days = Math.floor(diff / (86400000));
            const hours = Math.floor((diff % (86400000)) / 3600000);
            const minutes = Math.floor((diff % 3600000) / 60000);
            return { days, hours, minutes };
        }

        function checkEventAlarms() {
            events.forEach(e => {
                if (!e.completed && !e.alarmPlayed) {
                    const eventDateTime = new Date(`${e.date}T${e.time || '00:00'}:00`);
                    if (Math.abs(eventDateTime - new Date()) < 1000) {
                        playSound(eventAlarmSound, '.event-card-container', `#event_${e.id}`);
                        e.alarmPlayed = true;
                        LS.set('events', events);
                        if (Notification.permission === 'granted') {
                            new Notification('Countdown Event Reached', { body: `Event: ${e.name} has arrived!` });
                        }
                    }
                }
            });
        }
        
        function renderEvents() {
            const box = $('#eventList');
            box.innerHTML = '';
            events.sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                return (a.date + (a.time || '00:00')).localeCompare(b.date + (b.time || '00:00'));
            });
            events.forEach(e => {
                const d = eventDiff(e.date, e.time);
                const el = document.createElement('div');
                el.className = 'event-card';
                el.id = `event_${e.id}`;
                
                const timeStr = e.time ? formatTime(parseInt(e.time.split(':')[0]), parseInt(e.time.split(':')[1])) : '';
                const dateStr = new Date(e.date).toLocaleDateString();
                
                el.innerHTML = `<div class="event-details" ${e.completed ? 'style="opacity: 0.6; text-decoration: line-through;"' : ''}>
                <strong>${e.name}</strong><br>
                ${d ? `<span style="color: var(--brand); font-weight: bold;">${d.days}d ${d.hours}h ${d.minutes}m</span> remaining` : '<span style="color:var(--hi); font-weight:bold;">Event passed!</span>'}
                <div class="chip" style="margin-top:8px">${dateStr} ${timeStr}</div>
                </div>
                <div style="display:flex;gap:8px">
                <button class="btn ok" style="padding:8px" onclick="toggleEvent(${e.id})"><span class="material-symbols-outlined">done</span></button>
                <button class="btn delete-btn" style="padding:8px" onclick="removeEvent(${e.id})"><span class="material-symbols-outlined">delete</span></button>
                </div>`;
                box.appendChild(el);
            });
        }
        
        function renderEventStatsCounter() {
            const key = todayKey();
            eventsCompletedToday = LS.get('eventsCompletedToday', {});
            $('#eventsToday').textContent = (eventsCompletedToday[key] || 0);
        }

        $('#addEventBtn').onclick = addEvent;
        
        let timerInterval, remaining = 0, running = false, mode = LS.get("mode", "work");
        let sessionStartTime = null;
        const timeDisplay = $("#timeDisplay");
        const progressRing = $("#progressRing");
        const modeChip = $("#modeChip");
        const focusToggle = $("#focusToggle");
        const sessionPurposeInput = $("#sessionPurpose");
        let timerHistory = LS.get("timerHistory", []);
        
        const MODES = {
            stopwatch: { seconds: 0, label: "Stopwatch" },
            work: { seconds: 25 * 60, label: "Work" },
            short: { seconds: 5 * 60, label: "Short Break" },
            long: { seconds: 15 * 60, label: "Long Break" },
            custom: { seconds: LS.get("customSeconds", 25 * 60), label: "Custom" }
        };
        
        function cssVar(name) {
            return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
        }
        
        function updateTimeText() {
            const totalMinutes = Math.floor(Math.max(remaining, 0) / 60);
            const totalSeconds = Math.max(remaining, 0) % 60;
            const formattedMinutes = totalMinutes.toString().padStart(2, "0");
            const formattedSeconds = totalSeconds.toString().padStart(2, "0");
            timeDisplay.textContent = `${formattedMinutes}:${formattedSeconds}`;
            
            const circ = 339.292;
            let total = MODES[mode]?.seconds || 1;
            let progress;
            if (mode === "stopwatch") {
                total = 1500;
                progress = (remaining % total);
            } else {
                progress = Math.max(0, remaining);
            }
            const dash = circ * (progress / total);
            progressRing.setAttribute("stroke-dashoffset", (circ - dash).toFixed(3));
        }
        
        function setMode(m) {
            mode = m;
            LS.set("mode", m);
            modeChip.textContent = "Mode: " + (MODES[m]?.label || "Custom");
            if (m === "custom") {
                const secs = LS.get("customSeconds", 25 * 60);
                remaining = secs;
            } else if (MODES[m]) {
                remaining = MODES[m].seconds;
            } else {
                remaining = 0;
            }
            updateTimeText();
        }

        $('#modeSelectDropdown').addEventListener('change', (e) => {
            const value = e.target.value;
            const customInput = $('#customMinutesInput');
            if (value === "custom") {
                customInput.style.display = 'block';
                customInput.value = Math.round((LS.get("customSeconds", 25 * 60)) / 60);
                customInput.focus();
                setMode("custom");
            } else {
                customInput.style.display = 'none';
                setMode(value);
            }
        });

        $('#customMinutesInput').addEventListener('input', () => {
            const mins = Math.max(1, parseInt($('#customMinutesInput').value, 10) || 25);
            const secs = mins * 60;
            LS.set("customSeconds", secs);
            MODES.custom.seconds = secs;
            if (!running && mode === 'custom') {
                remaining = secs;
                updateTimeText();
            }
        });

        function tick() {
            if (!running) return;
            if (mode === "stopwatch") {
                remaining++;
            } else {
                remaining--;
                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    running = false;
                    recordSession();
                    updateTimeText();
                    playSound(timerEndSound, '.timer-card');
                }
            }
            updateTimeText();
            if (focusToggle.checked) addFocusSecond();
        }
        
        function recordSession() {
            if (!sessionStartTime) return; 
            const purpose = sessionPurposeInput.value.trim() || 'No purpose specified';
            const endTime = new Date();
            const duration = Math.abs(endTime.getTime() - sessionStartTime.getTime()) / 1000;
            
            if (duration > 1) { 
                const session = {
                    startTime: sessionStartTime.toISOString(),
                    endTime: endTime.toISOString(),
                    duration: Math.round(duration),
                    purpose: purpose
                };
                timerHistory.unshift(session);
                LS.set('timerHistory', timerHistory);
                renderTimerHistory();
            }
            sessionPurposeInput.value = '';
            sessionStartTime = null; 
        }
        
        function start() {
            if (running) return;
            running = true;
            if (!sessionStartTime) { 
                sessionStartTime = new Date();
            }
            timerInterval = setInterval(tick, 1000);
        }

        function pause() {
            running = false;
            clearInterval(timerInterval);
        }
        
        function reset() {
            if(running) {
                recordSession(); 
            }
            running = false;
            clearInterval(timerInterval);
            sessionStartTime = null;
            setMode(mode);
        }
        
        $("#startBtn").onclick = start;
        $("#pauseBtn").onclick = pause;
        $("#resetBtn").onclick = reset;
        
        window.setMode = setMode;
        window.start = start;
        window.toggleTask = toggleTask;
        window.deleteTask = deleteTask;
        window.toggleEvent = toggleEvent;
        window.removeEvent = removeEvent;
        
        function addFocusSecond() {
            const stats = LS.get("stats", {});
            const key = todayKey();
            stats[key] = (stats[key] || 0) + 1;
            LS.set("stats", stats);
            renderStats();
            renderProductivityIndex();
        }

        function renderProductivityIndex() {
            const tasksDoneToday = LS.get('tasksCompletedToday', {})[todayKey()] || 0;
            const focusMinutesToday = ((LS.get("stats", {})[todayKey()] || 0) / 60);
            const overdueTasksCount = tasks.filter(t => !t.completed && t.due && new Date(`${t.due}T${t.dueTime || '23:59'}:00`) < new Date()).length;

            const statusEl = $('#productivityStatus');
            const iconEl = $('#productivityIcon');
            const iconContainerEl = $('#productivityIconContainer');

            let status = { text: "Getting Started", icon: "coffee", color: "var(--muted)" };

            if (overdueTasksCount > 2) {
                status = { text: "Catch Up!", icon: "error", color: "var(--accent)" };
            } else if (tasksDoneToday >= 5 || focusMinutesToday >= 120) {
                status = { text: "Excellent!", icon: "rocket_launch", color: "var(--ok)" };
            } else if (tasksDoneToday >= 3 || focusMinutesToday >= 60) {
                status = { text: "Productive", icon: "trending_up", color: "var(--brand)" };
            } else if (tasksDoneToday > 0 || focusMinutesToday > 15) {
                status = { text: "On Track", icon: "thumb_up", color: "var(--warn)" };
            }

            statusEl.textContent = status.text;
            iconEl.textContent = status.icon;
            iconContainerEl.style.background = status.color;
        }
        
        function renderStats() {
            const stats = LS.get("stats", {});
            const key = todayKey();
            $("#focusToday").textContent = ((stats[key] || 0) / 60).toFixed(1) + "m";
            
            const ctx = $("#weekChart").getContext("2d");
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            
            const keys = [...Array(7)].map((_, i) => {
                const d = new Date();
                d.setDate(d.getDate() - (6 - i));
                return d.toISOString().slice(0, 10);
            });
            const vals = keys.map((k) => (stats[k] || 0) / 60);
            const w = ctx.canvas.width, h = ctx.canvas.height, step = (w - 40) / 7;
            
            ctx.lineWidth = 1;
            ctx.strokeStyle = cssVar("--border");
            ctx.beginPath();
            ctx.moveTo(30, 10);
            ctx.lineTo(30, h - 20);
            ctx.lineTo(w - 10, h - 20);
            ctx.stroke();
            
            const maxVal = Math.max(...vals, 1);
            const barColor = cssVar("--brand");
            ctx.fillStyle = barColor;
            const barWidth = 12;
            
            vals.forEach((v, i) => {
                const barH = (v / maxVal) * (h - 40);
                const x = 30 + i * step + (step - barWidth) / 2;
                const y = (h - 20) - barH;
                ctx.fillRect(x, y, barWidth, barH);
            });
            
            ctx.fillStyle = cssVar("--text");
            ctx.font = "10px Roboto";
            ctx.textAlign = 'center';
            keys.forEach((k, i) => {
                const d = new Date(k);
                const label = d.toLocaleDateString(undefined, { weekday: "short" });
                const x = 30 + i * step + step / 2;
                ctx.fillText(label, x, h - 5);
            });
        }
        
        function renderTimerHistory() {
            const historyList = $("#sessionHistory");
            historyList.innerHTML = '';

            if (timerHistory.length === 0) {
                historyList.innerHTML = `<div class="history-empty-state">No timer sessions recorded yet.</div>`;
                return;
            }

            timerHistory.forEach((session) => {
                const sessionEl = document.createElement('div');
                sessionEl.className = 'history-entry';

                const durationMinutes = Math.floor(session.duration / 60);
                const durationSeconds = session.duration % 60;
                const durationText = durationMinutes > 0 ? `${durationMinutes}m ${durationSeconds}s` : `${durationSeconds}s`;

                const purposeContainer = document.createElement('div');
                purposeContainer.className = 'history-purpose';
                purposeContainer.textContent = session.purpose;

                purposeContainer.addEventListener('click', () => {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = session.purpose;
                    purposeContainer.replaceWith(input);
                    input.focus();
                    
                    const savePurpose = () => {
                        const newPurpose = input.value.trim() || 'No purpose specified';
                        if (newPurpose !== session.purpose) {
                            session.purpose = newPurpose;
                            LS.set('timerHistory', timerHistory);
                        }
                        input.replaceWith(purposeContainer);
                        purposeContainer.textContent = newPurpose;
                    };

                    input.addEventListener('blur', savePurpose);
                    input.addEventListener('keydown', (e) => { if (e.key === 'Enter') input.blur(); });
                });
                
                let timestampText;
                const timeFormatOptions = { hour: 'numeric', minute: '2-digit' };
                if (session.startTime && session.endTime) {
                    const start = new Date(session.startTime);
                    const end = new Date(session.endTime);
                    timestampText = `${start.toLocaleDateString(undefined, { month: 'short', day: 'numeric' })} • ${start.toLocaleTimeString([], timeFormatOptions)} - ${end.toLocaleTimeString([], timeFormatOptions)}`;
                } else { 
                    const end = new Date(session.start);
                    const start = new Date(end.getTime() - (session.duration * 1000));
                    timestampText = `${start.toLocaleDateString(undefined, { month: 'short', day: 'numeric' })} • ${start.toLocaleTimeString([], timeFormatOptions)} - ${end.toLocaleTimeString([], timeFormatOptions)}`;
                }

                sessionEl.innerHTML = `
                    <div class="history-icon-wrapper">
                        <span class="material-symbols-outlined">history</span>
                    </div>
                    <div class="history-details">
                        <div class="history-timestamp">${timestampText}</div>
                    </div>
                    <div class="history-duration">${durationText}</div>
                `;
                
                sessionEl.querySelector('.history-details').prepend(purposeContainer);
                historyList.appendChild(sessionEl);
            });
        }
        
        function updateKolkataTime() {
            const now = new Date();
            const kol = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Kolkata" }));
            const hours = kol.getHours();
            const minutes = kol.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const formattedHours = hours % 12 || 12;
            const formattedMinutes = minutes.toString().padStart(2, '0');
            $("#kolkataTime").textContent = `${formattedHours}:${formattedMinutes} ${ampm}`;
        }
        
        function exportData() {
            try {
                const data = {
                    tasks: LS.get('tasks', []),
                    events: LS.get('events', []),
                    stats: LS.get('stats', {}),
                    timerHistory: LS.get('timerHistory', []),
                    theme: LS.get('theme', 'light'),
                    mode: LS.get('mode', 'work'),
                    customSeconds: LS.get('customSeconds', 25 * 60),
                    tasksCompletedToday: LS.get('tasksCompletedToday', {}),
                    eventsCompletedToday: LS.get('eventsCompletedToday', {})
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'productivity-hub-data.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error("Failed to export data:", error);
                alert("Could not export data. See console for details.");
            }
        }
        
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    localStorage.clear(); 
                    for (const key in data) {
                        if (Object.hasOwnProperty.call(data, key)) {
                            LS.set(key, data[key]);
                        }
                    }
                    alert('Data imported successfully! The page will now reload.');
                    location.reload();
                } catch (error) {
                    console.error("Failed to import data:", error);
                    alert('Invalid JSON file. Please select a valid data file.');
                }
            };
            reader.onerror = () => {
                alert('Error reading the file.');
            };
            reader.readAsText(file);
        }
        
        $('#exportBtn').addEventListener('click', exportData);
        $('#importInput').addEventListener('change', importData);
        
        function hydrate() {
            const savedMode = LS.get("mode", "work");
            setMode(savedMode);
            $('#modeSelectDropdown').value = savedMode;

            if (savedMode === 'custom') {
                const customInput = $('#customMinutesInput');
                customInput.style.display = 'block';
                customInput.value = Math.round((LS.get("customSeconds", 25 * 60)) / 60);
            }
            
            initDatePickers();
            renderTasks();
            renderEvents();
            renderStats();
            renderStatsCounters();
            renderEventStatsCounter();
            renderProductivityIndex();
            renderTimerHistory();
            updateTimeText();
            
            if (Notification.permission !== 'granted') {
                Notification.requestPermission();
            }
        }
        
        setInterval(() => {
            updateKolkataTime();
            checkTaskAlarms();
            checkEventAlarms();
        }, 1000);

        hydrate();
    </script>
</body>
</html>


## For Example You Can Check The Website That I Have Created With This Code 

## ==> https://productivityhub.odoo.com/

## ===> Yeah You Can Create Your Odoo Website With Your Own Code No Need to Use Templates 
